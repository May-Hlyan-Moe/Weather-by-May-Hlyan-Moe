<!DOCTYPE html>
<html>

<head>
  <title>Weather by May-Hlyan-Moe</title>
  <meta charset="UTF-8" />

  <link rel="stylesheet" href="https://kit.fontawesome.com/aad74cd859.css" crossorigin="anonymous" />
  <script src="https://kit.fontawesome.com/aad74cd859.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Josefin+Sans:wght@500&family=Kanit&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <style>
        body {
        background: #ddd6d2;
        margin: 30px auto;
        }

        h1 {
        color: #5e4d44;
        font-family: "Fredoka One", cursive;
        font-size: 60px;
        }

        h3 {
        font-family: "Fredoka One", cursive;
        }

        

        #description {
        color: #443b2c;
        font-family: "Fredoka One", cursive;
        text-align: right;
        font-size: 30px;
        }

        #data {
        font-family: "Fredoka One", cursive;
        text-align: right;
        color: #6b593c;
        font-size: 25px;
        }

        .myan {
        font-size: 30px;
        }

        button {
        display: block;
        margin: auto;
        color: chocolate;
        }

        .temperature {
        font-size: 60px;
        font-family: "Josefin Sans", sans-serif;
        font-weight: bold;
        color: black;
        
        }

        #unit {
        font-size: 30px;
        font-family: "Josefin Sans", sans-serif;
        color: #4a3333;
        margin-left: 0;
        position: relative;
        top: -19px;
        }

        .luck {
        padding: 7px 100px;
        }

        .lucky {
        padding: 7px 50px;
        }

        footer {
        text-decoration: underline;
        font-family: "Fredoka One", cursive;
        color: #905858;
        }

        table {
        font-family: "Josefin Sans", sans-serif;
        color: #5d3a3a;
        }

        footer:hover {
        cursor: pointer;
        }

        #tempC {
        color: black;
        font-family: "Fredoka One", cursive;
        cursor: default;
        opacity: 0.5;
        }

        #tempF {
        color: black;
        font-family: "Fredoka One", cursive;
        cursor: default;
        opacity: 0.5;
        }

        #tempC:hover {
        text-decoration: none;
        }

        #tempF:hover {
        text-decoration: none;
        }

        #search-form {
        max-width: fit-content;
        }

        #current {
        background-color: #ffffff;
        color: #707070;
        border: 1px solid #A0937D;
        border-radius: 4px;
        transition: transform 1s ease;
        font-family: "Fredoka One", cursive;
        margin: 10px 0;
        padding: 5px;
        }
        #current:hover {
        transform: scale(1.1);
        }

        #search-button {
        color: #707070;
        background-color: #ffffff;
        border: 1px solid #A0937D;
        border-radius: 4px;
        transition: transform 1s ease;
        font-family: "Fredoka One", cursive;
        margin: 10px 0;
        padding: 5px;
        }

        #search-button:hover {
        transform: scale(1.1);
        }

        #city-input {
        color: #3e4341;
        font-family: "Fredoka One", cursive;
        margin: 10px 0;
        border: 1px solid #A0937D;
        border-radius: 4px;
        padding: 5px;
        }

        .App {
        margin: 30px 40px;
        border: 1px solid #A0937D;
        border-radius: 10px;
        padding: 30px;
        
        }

        #code {
        font-family: "Courier New", Courier, monospace;
        }

        #clear-sky {
        text-transform: capitalize;
        }

        #unit .active {
          color: black;
          opacity: 1;
        }

        #weather-forecast {
            font-family: "Fredoka One", cursive;
            font-size: 20px;
        }

        #tomorrows-temperature-min {
            opacity: 0.5;
        }

        #tomorrows {
          color: #6b593c;
        }
  </style>
</head>

<body>

  <body>
    <div class="App">
      <form class="search-form mb-3" id="search-form">
        <div class="row">
          <div class="col-mid-6">
            <input type="search" placeholder="Type a city.." autofocus="on" autocomplete="off" id="city-input" class="form-control shadow-sm" />
          </div>
          <div class="col-mid-3">
            <input type="submit" value="Search" class="form-control btn btn-primary shadow-sm" id="search-button" />
          </div>
          <div class="col-mid-3">
            <input type="submit" value="Current" class="form-control btn btn-primary shadow-sm" id="current" />
          </div>
        </div>
      </form>

      <h1>
        <span id="town">
          
        </span>
        ,
        <span id="country">
          
        </span>
      </h1>

      <hr />
      <h2 id="data">
        
      </h2>
      <div id="description">
        
      </div>
      <hr />
      <div class="clearfix weatherTemperature">
        <div scope="row">
            
            <img src="" width="100" height="100" id="icon" alt="clear" />

            <span class="temperature">
            
            </span>

            <span id="unit">
            <a href="#" id="tempC" class="active">
                째C
            </a>
            /
            <a href="#" id="tempF">
                째F
            </a>
            </span>

        </div>
      </div>

      

      <table class="table table-dark">

        <tbody>
          <tr>
            <th scope="row"></th>
            <td class="lucky">
                Description
            </td>
            <td>
              <span id="clear-sky">
                
              </span>

            </td>
          </tr>
          <tr>
            <th scope="row"></th>
            <td class="lucky">
                Wind Speed
            </td>
            <td class="luck"> 
                <span id="wind-speed">
                  
                </span> 
                km/h
            </td>
          </tr>

          <tr>
            <th scope="row"></th>
            <td class="lucky">
                Humidity
            </td>
            <td class="luck"> 
                <span id="humidity"> 
                    
                </span>
                %
            </td>
          </tr>
          <tr>
            <th scope="row"></th>
            <td class="lucky">
                Pressure
            </td>
            <td class="luck"> 
                <span id="pressure">
                    
                </span>
                mb
            </td>
          </tr>
          <tr>
            <th scope="row"></th>
            <td class="lucky">
                Visibility
            </td>
            <td class="luck"> 
                <span id="visibility"> 
                
                </span> 
                km
            </td>
          </tr>
        </tbody>
      </table>

      <hr />

    <span id="weather-forecast">
        <div scope="col">
            <div scope="row">
                <span id="tomorrows">
                    
                </span> 
                <img src="" width="60" height="60" /> 
                <span id="tomorrows-temperature">
                    <span id="tomorrows-temperature-max">
                        
                    </span>
                    <span id="tomorrows-temperature-min">
                        
                    </span>
                </span>
            </div>

            
        </div>

    </span>

      <hr />
      <small>
        <span id="code">
          <a href="https://github.com/May-Hlyan-Moe/Weather-by-May-Hlyan-Moe">
            open-sourced code
          </a>
          by May Hlyan Moe
        </span>
      </small>
    </div>
    <script>
      
          function dateFormat(timestamp) {
            let now = new Date();
            let hours = now.getHours();
            if (hours < 10) {
              hours = `0${hours}`;
            }
            let minutes = now.getMinutes();
            if (minutes < 10) {
              minutes = `0${minutes}`;
            }
            let days = [
              "Sunday",
              "Monday",
              "Tuesday",
              "Wednesday",
              "Thursday",
              "Friday",
              "Saturday",
            ];
            let day = days[now.getDay()];
            return `${day} ${hours}:${minutes}`;

            /*console.log(minutes);
            console.log(hours);
            console.log(day); */
          }

          // forecast

          function formatDay (timestamp) {
            let date = new Date(timestamp * 1000);
            let day = date.getDay();
            let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]

            return days[day];
          }

          function displayForecast(response) {
            let forecast = response.data.daily;
            console.log(forecast);
            let forecastElement = document.querySelector("#weather-forecast");

            let forecastHTML = `<div scope="col">`;


            forecast.forEach(function (forecastDay , index) {
              if (index < 4) {
              forecastHTML =
                forecastHTML +
                `   <div scope="row"> 
                                <span id="tomorrows">
                                    ${formatDay(forecastDay.time)}
                                </span> 
                            <img src=${forecastDay.condition.icon_url} width="60" height="60" /> 
                            <span id="tomorrows-temperature">
                                <span id="tomorrows-temperature-max">
                                    ${Math.round(forecastDay.temperature.maximum)}째
                                </span>
                                <span id="tomorrows-temperature-min">
                                    ${Math.round(forecastDay.temperature.minimum)}째
                                </span>
                            </span>
                            </div>`
                          }
            });
          
            forecastHTML = forecastHTML + `</div>`;

            forecastElement.innerHTML = forecastHTML;
          }

          //feature2
           function getForecast(coordinates) {
            let key="e8b0a10cf3eacat9055e9544c4bb244o";
            /*let apiUrl=`https://api.openweathermap.org/data/3.0/onecall?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=a2dda52dce059eb8a14e95aaa0db6ab7&units=metric`; */
            let apiUrl = `https://api.shecodes.io/weather/v1/forecast?lon=${coordinates.lon}&lat=${coordinates.lat}&key=${key}&units=metric `
            console.log(apiUrl);
            axios.get(apiUrl).then(displayForecast);
          }

          //feature3
          function showWeather(response) {
            document.querySelector("#town").innerHTML = response.data.name;

            document.querySelector(".temperature").innerHTML = Math.round(
              response.data.main.temp
            );

            celsius = response.data.main.temp;

            document.querySelector("#humidity").innerHTML =
              response.data.main.humidity;

            document.querySelector("#wind-speed").innerHTML = Math.round(
              response.data.wind.speed * 3.6
            );

            document.querySelector("#pressure").innerHTML =
              response.data.main.pressure;

            document.querySelector("#visibility").innerHTML =
              response.data.visibility * 0.001;

            document.querySelector("#country").innerHTML =
              response.data.sys.country;

            document.querySelector("#description").innerHTML =
              response.data.weather[0].main;

            document.querySelector("#clear-sky").innerHTML =
              response.data.weather[0].description;

            let dateAndTime = document.querySelector("#data");
            dateAndTime.innerHTML = dateFormat(response.data.dt * 1000);

            let iconElement = document.querySelector("#icon");

            iconElement.setAttribute(
              "src",
              `https://openweathermap.org/img/wn/${response.data.weather[0].icon}@2x.png`
            );

            /* iconElement.setAttribute("alt", response.data.weather[0].description); */
          
            getForecast(response.data.coord);
          
          
          }

          function localSearch(city) {
            let apiKey = "acc40a9f616ea523d341bf54d25ae67f";
            let apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&APPID=acc40a9f616ea523d341bf54d25ae67f&units=metric`;
            axios.get(apiUrl).then(showWeather);
          }

          function search(event) {
            event.preventDefault();
            let city = document.querySelector("#city-input").value;

            localSearch(city);
          }
          /*let yangon = document.querySelector("#town");
            let cityInput = document.querySelector("#city-input");
            yangon.innerHTML = cityInput.value;
            }
            */
          let searchCity = document.querySelector("#search-form");
          searchCity.addEventListener("submit", search);
          function searchCurrentFunction(position) {
            let apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${position.coords.latitude}&lon=${position.coords.longitude}&APPID=acc40a9f616ea523d341bf54d25ae67f&units=metric`;
            axios.get(apiUrl).then(showWeather);
          }

          function currentFunction(event) {
            event.preventDefault();
            navigator.geolocation.getCurrentPosition(searchCurrentFunction);
          }

          let currentLocation = document.querySelector("#current");
          currentLocation.addEventListener("click", currentFunction);

          //feature3

          function celsiusFunction(event) {
            event.preventDefault();

            let formula = document.querySelector(".temperature");
            formula.innerHTML = Math.round(celsius);

            celsiusLink.classList.add("active");
            fahrenheit.classList.remove("active");
          }

          let celsiusLink = document.querySelector("#tempC");
          celsiusLink.addEventListener("click", celsiusFunction);

          let celsius = null;

          function fahrenheitFunction(event) {
            event.preventDefault();
            let fahrenheitTemp = (celsius * 9) / 5 + 32;

            let formula = document.querySelector(".temperature");
            formula.innerHTML = Math.round(fahrenheitTemp);

            celsiusLink.classList.remove("active");
            fahrenheit.classList.add("active");
          }

          let fahrenheit = document.querySelector("#tempF");
          fahrenheit.addEventListener("click", fahrenheitFunction);

          localSearch("Yangon");
          displayForecast();



    </script>
    
</body>

</html>